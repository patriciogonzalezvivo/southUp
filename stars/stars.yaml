sources:
    constellations:
        type: GeoJSON
        url: sources/const.json
        max_display_zoom: 5
    stars:
        type: GeoJSON
        url: sources/stars.6.json
        max_display_zoom: 5        
textures:
    stars:
        url: stars.png
        filtering: mipmap
        sprites:
            # define sprites: [x origin, y origin, width, height]
            dot: [0, 0, 50, 50]
            four: [50, 0, 50, 50]
            five: [100, 0, 50, 50]
            six: [0, 50, 50, 50]
            eight: [50, 50, 50, 50]
            nine: [100, 50, 50, 50]

layers:
    constellations:
        data: { source: constellations, layer: lines }
        filter: { $zoom: { max: 5 } }
        draw:
            lines:
                interactive: true
                width: [[0,5px], [4,8px]]
                order: 10000
                color: |
                    function() {
                        return [feature.id/255.,1,1,1];
                    }
                style: constellations
    stars:
        data: { source: stars }
        filter: { $zoom: { max: 5 } }
        draw:
            points:
                priority: 7
                size: [[0,2px],[4,10px]]
                order: 10001
                color: white
                style: stars
                sprite: dot
        huge:
            filter: { mag: { min: 0, max: 1 }}
            draw:
                points:
                    priority: 1
                    sprite: nine
                    size: [[0,20px], [4,30px]]
                    color: white
        very-big:
            filter: { mag: { min: 1, max: 2 }}
            draw:
                points:
                    priority: 2
                    sprite: eight
                    size: [[0,15px],[4,25px]]
                    color: white
        big:
            filter: { mag: { min: 2, max: 3 }}
            draw:
                points:
                    priority: 3
                    sprite: six
                    size: [[0,10px],[4,20px]]
                    color: white
        medium:
            filter: { mag: { min: 3, max: 4 }}
            draw:
                points:
                    priority: 4
                    sprite: five
                    size: [[0,5px],[4,10px]]
                    color: white
        small:
            filter: { mag: { min: 3, max: 4 }}
            draw:
                points:
                    priority: 5
                    sprite: four
                    size: [[0,2px],[4,5px]]
                    color: white
        tiny:
            filter: { mag: { min: 5, max: 6 }}
            draw:
                points:
                    priority: 6
                    sprite: dot
                    size: [[0,2px],[4,5px]]
                    color: white

styles:
    on-sky:
        shaders:
            blocks:
                position: |
                    position.z += 8000000.;
    stars:
        base: points
        texture: stars
        mix: [points-southup, on-sky, functions-zoom]
        blend: alpha
        shaders:
            defines:
                ZOOM_START: 2.
                ZOOM_END: 7.
            blocks:
                color: |
                    float z = zoom();
                    color.a = smoothstep(1.,0.,z);
    constellations:
        base: lines
        mix: [lines-southup, on-sky, functions-zoom]
        texcoords: true
        blend: overlay
        shaders:
            defines:
                ZOOM_START: 2.
                ZOOM_END: 4.
            uniforms:
                u_selected: 0
            blocks:
                color: |
                    float z = zoom();
                    color.rgb = vec3(.8);
                    if (ceil(v_color.r*255.)==u_selected) {
                        color.rgb = vec3(1.);
                    }
                    // Glow
                    color.a = sin(v_texcoord.x*3.1415)*mix(.1,0.,z); 
                    // Line
                    color.a += (smoothstep(mix(0.98,0.999,z), 1., sin(v_texcoord.x*3.1415))*step(.3,fract(v_texcoord.y)))*mix(1.,0.,z);
    milkway:
        base: polygons
        mix: [polygons-southup, on-sky, functions-zoom]
                