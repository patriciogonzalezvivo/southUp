sources:
    constellations:
        type: GeoJSON
        url: sources/const.json
        max_display_zoom: 7
    stars:
        type: GeoJSON
        url: sources/stars.6.json
        max_display_zoom: 7
        
textures:
    stars:
        url: stars.png
        filtering: mipmap
        sprites:
            # define sprites: [x origin, y origin, width, height]
            dot: [0, 0, 50, 50]
            four: [50, 0, 50, 50]
            five: [100, 0, 50, 50]
            six: [0, 50, 50, 50]
            eight: [50, 50, 50, 50]
            nine: [100, 50, 50, 50]

layers:
    constellations-labels:
        data: { source: constellations, layer: labels }
        filter:
            - $zoom: { max: 3 }
        draw:
            text:
                style: txt-flip
                priority: 20
                font:
                    fill: white
                    family: Times, Baskerville
                    size: 14px
                    stroke:
                        color: [0.638,0.641,0.678]
                        width: 3
    constellations:
        data: { source: constellations, layer: lines }
        filter: { $zoom: { max: 7 } }
        draw:
            lines:
                width: [[0,5px], [6,10px]]
                order: 10000
                color: white
                style: constellations
    stars:
        data: { source: stars }
        filter: { $zoom: { max: 6 } }
        draw:
            points:
                size: [[0,14px],[8,20px]]
                order: 10001
                color: white
                style: stars
                sprite: dot
        huge:
            filter: { mag: { min: 0, max: 1 }}
            draw:
                points:
                    sprite: nine
                    size: [[0,25px], [8,50px]]
                    color: white
        very-big:
            filter: { mag: { min: 1, max: 2 }}
            draw:
                points:
                    sprite: eight
                    size: [[0,35px],[8,40px]]
                    color: white
        big:
            filter: { mag: { min: 2, max: 3 }}
            draw:
                points:
                    sprite: six
                    size: [[0,30px],[8,40px]]
                    color: white
        medium:
            filter: { mag: { min: 3, max: 4 }}
            draw:
                points:
                    sprite: five
                    size: [[0,25px],[8,30px]]
                    color: white
        small:
            filter: { mag: { min: 3, max: 4 }}
            draw:
                points:
                    sprite: four
                    size: [[0,20px],[8,43px]]
                    color: white
        tiny:
            filter: { mag: { min: 5, max: 6 }}
            draw:
                points:
                    sprite: four
                    size: [[0,15px],[8,20px]]
                    color: white

styles:
    on-sky:
        shaders:
            blocks:
                position: |
                    position.z += 999999.;
    stars:
        base: points
        texture: stars
        mix: [flip, on-sky]
        blend: alpha
    constellations:
        base: lines
        mix: [flip, on-sky, functions-zoom]
        texcoords: true
        blend: overlay
        shaders:
            defines:
                ZOOM_START: 4.
                ZOOM_END: 6.
                BRIGHTNESS: mix(0.98,0.999,z)
            blocks:
                color: |
                    float z = zoom();
                    color.a = sin(v_texcoord.x*3.1415)*mix(.1,0.,z);
                    color.a += (smoothstep(BRIGHTNESS, 1., sin(v_texcoord.x*3.1415))*step(.3,fract(v_texcoord.y)))*mix(1.,0.,z);
                